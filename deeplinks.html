<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>GEMS Member App</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          Oxygen, Ubuntu, Cantarell, sans-serif;
      }

      body {
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
        background-color: #f5f5f5;
        padding: 20px;
      }

      .container {
        background: white;
        padding: 30px;
        border-radius: 12px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        max-width: 500px;
        width: 100%;
        text-align: center;
      }

      .logo {
        width: 120px;
        height: 120px;
        margin-bottom: 20px;
        background-color: #f0f0f0;
        border-radius: 20px;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-left: auto;
        margin-right: auto;
      }

      h1 {
        color: #333;
        margin-bottom: 15px;
        font-size: 24px;
      }

      .description {
        color: #666;
        margin-bottom: 25px;
        font-size: 16px;
        line-height: 1.5;
      }

      .button {
        background-color: #007aff;
        color: white;
        padding: 16px 32px;
        border-radius: 8px;
        border: none;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        width: 100%;
        max-width: 300px;
        transition: background-color 0.2s;
      }

      .button:hover {
        background-color: #0056b3;
      }

      .fallback-text {
        margin-top: 15px;
        color: #666;
        font-size: 14px;
      }

      .store-buttons {
        display: none;
        gap: 10px;
        margin-top: 20px;
        flex-direction: column;
      }

      .store-button {
        padding: 12px 24px;
        border: 1px solid #ddd;
        border-radius: 8px;
        background: white;
        color: #333;
        text-decoration: none;
        font-weight: 500;
        transition: background-color 0.2s;
      }

      .store-button:hover {
        background-color: #f5f5f5;
      }

      @media (min-width: 768px) {
        .mobile-only {
          display: none;
        }
        .desktop-message {
          display: block;
        }
      }

      @media (max-width: 767px) {
        .mobile-only {
          display: block;
        }
        .desktop-message {
          display: none;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="logo">GEMS</div>

      <div class="desktop-message">
        <h1>GEMS Member App</h1>
        <p class="description">
          Please open this page on your mobile device to access the GEMS Member
          app, or download it directly from your device's app store.
        </p>
        <div class="store-buttons">
          <a
            href="https://play.google.com/store/apps/details?id=za.gov.GEMS.Member"
            class="store-button"
            target="_blank"
            rel="noopener"
          >
            Download for Android
          </a>
          <a
            href="https://apps.apple.com/app/za.gov.GEMS.Member"
            class="store-button"
            target="_blank"
            rel="noopener"
          >
            Download for iOS
          </a>
        </div>
      </div>

      <div class="mobile-only">
        <h1>GEMS Member App</h1>
        <p class="description">
          Click below to open or download the GEMS Member app
        </p>
        <button onclick="openGEMSApp()" class="button">
          Open GEMS Member App
        </button>
        <p class="fallback-text" id="fallbackText"></p>
      </div>
    </div>

    <script>
      const APP_CONFIG = {
        schemes: [
          "za.gov.GEMS.Member://app", // Primary scheme
          "gemsmember://app", // Backup scheme
        ],
        urls: {
          android:
            "https://play.google.com/store/apps/details?id=za.gov.GEMS.Member",
          ios: "https://apps.apple.com/za/app/gems-member/id1143528073", // Update with actual App Store URL
          fallback: "https://www.gems.gov.za",
        },
        timeouts: {
          appOpen: 2500,
          redirect: 500,
        },
      };

      function openGEMSApp() {
        const platform = detectPlatform();

        if (platform === "desktop") {
          showMessage("Please open this link on your mobile device");
          window.location.href = APP_CONFIG.urls.fallback;
          return;
        }

        const startTime = Date.now();
        let appOpened = false;

        // Try primary scheme first
        tryOpenApp(APP_CONFIG.schemes[0]);

        // Listen for visibility change
        document.addEventListener(
          "visibilitychange",
          () => {
            if (document.hidden) {
              appOpened = true;
            }
          },
          { once: true }
        );

        // Set timeout for store fallback
        setTimeout(() => {
          if (!appOpened && !document.hidden) {
            handleAppNotOpened(platform);
          }
        }, APP_CONFIG.timeouts.appOpen);
      }

      function tryOpenApp(scheme) {
        const iframe = document.createElement("iframe");
        iframe.style.display = "none";
        iframe.src = scheme;
        document.body.appendChild(iframe);

        setTimeout(() => {
          document.body.removeChild(iframe);
        }, 100);

        window.location.href = scheme;
      }

      function handleAppNotOpened(platform) {
        const storeUrl =
          platform === "ios" ? APP_CONFIG.urls.ios : APP_CONFIG.urls.android;
        showMessage("Opening app store...");
        setTimeout(() => {
          window.location.href = storeUrl;
        }, APP_CONFIG.timeouts.redirect);
      }

      function detectPlatform() {
        const ua = navigator.userAgent.toLowerCase();
        if (/iphone|ipad|ipod/.test(ua)) return "ios";
        if (/android/.test(ua)) return "android";
        return "desktop";
      }

      function showMessage(message) {
        const fallbackText = document.getElementById("fallbackText");
        if (fallbackText) {
          fallbackText.textContent = message;
        }
      }

      // Show/hide store buttons based on platform
      document.addEventListener("DOMContentLoaded", () => {
        const platform = detectPlatform();
        if (platform === "desktop") {
          document.querySelector(".store-buttons").style.display = "flex";
        }
      });
    </script>
  </body>
</html>
