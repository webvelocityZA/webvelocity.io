<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GEMS Member App</title>
    <style>
        /* ... Previous styles remain the same ... */
    </style>
</head>
<body>
    <div class="container">
        <div class="logo">
            GEMS
        </div>
        
        <div class="mobile-only">
            <h1>GEMS Member App</h1>
            <p class="description">
                Click below to open or download the GEMS Member app
            </p>
            <button onclick="openGEMSApp()" class="button">Open GEMS Member App</button>
            <p class="fallback-text" id="fallbackText"></p>
        </div>
    </div>

    <script>
        const APP_CONFIG = {
            schemes: [
                'za.gov.gems.member://app',  // Notice the lowercase
                'gemsmember://app',          // Backup scheme
                'gemsmemberapp://',          // Another variation
                'gems://'                    // Simplest variation
            ],
            urls: {
                android: 'https://play.google.com/store/apps/details?id=za.gov.GEMS.Member',
                ios: 'https://apps.apple.com/za/app/gems-member/id1143528073', // Update with actual App Store URL
                fallback: 'https://www.gems.gov.za'
            },
            timeouts: {
                appOpen: 1500,
                redirect: 500
            }
        };

        function openGEMSApp() {
            const platform = detectPlatform();
            const startTime = Date.now();
            let hasOpened = false;

            // Try each scheme in sequence
            function tryNextScheme(index) {
                if (index >= APP_CONFIG.schemes.length) {
                    // If none of the schemes worked, go to store
                    handleAppNotOpened(platform);
                    return;
                }

                const scheme = APP_CONFIG.schemes[index];
                
                if (platform === 'ios') {
                    // For iOS, use window.location
                    window.location.href = scheme;
                } else {
                    // For Android, try using intent
                    const intent = `intent://${scheme.replace('://', '/')}#Intent;scheme=${scheme.split('://')[0]};package=za.gov.gems.member;end`;
                    window.location.href = intent;
                }

                setTimeout(() => {
                    if (!hasOpened && !document.hidden) {
                        tryNextScheme(index + 1);
                    }
                }, 500);
            }

            // Start trying schemes
            tryNextScheme(0);

            // Listen for app open
            document.addEventListener('visibilitychange', () => {
                if (document.hidden) {
                    hasOpened = true;
                }
            }, { once: true });

            // Fallback timer
            setTimeout(() => {
                if (!hasOpened && !document.hidden) {
                    handleAppNotOpened(platform);
                }
            }, APP_CONFIG.timeouts.appOpen);
        }

        function handleAppNotOpened(platform) {
            const storeUrl = platform === 'ios' ? APP_CONFIG.urls.ios : APP_CONFIG.urls.android;
            showMessage('Opening app store...');
            setTimeout(() => {
                window.location.href = storeUrl;
            }, APP_CONFIG.timeouts.redirect);
        }

        function detectPlatform() {
            const ua = navigator.userAgent.toLowerCase();
            if (/iphone|ipad|ipod/.test(ua)) return 'ios';
            if (/android/.test(ua)) return 'android';
            return 'desktop';
        }

        function showMessage(message) {
            const fallbackText = document.getElementById('fallbackText');
            if (fallbackText) {
                fallbackText.textContent = message;
            }
        }
    </script>
</body>
</html>
